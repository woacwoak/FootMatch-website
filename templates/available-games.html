<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Available Games | FootMatch</title>

    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css_folder/reset.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css_folder/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css_folder/available-games.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css_folder/error-messages.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css_folder/header.css') }}">
    <script src="{{ url_for('static', filename='js/navigation.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/description.js') }}" defer></script>
</head>

<div id="gameModal" class="modal">
  <div class="modal-content">
    <h3 id="modalGameTitle">Game Title</h3>
    <p id="modalGameInfo">Game details will appear here.</p>
    <button class="btn close-btn" onclick="closeModal()">Close</button>
  </div>
</div>

<body>
    <!--HEADER-->
    <section id="header">
        <header>
            <div class="header-container">
                <p id="title">FootMatch</p>

                <nav id="header-nav">
                    <a href="{{ url_for('home') }}#header">Home</a>
                    <a href="{{ url_for('home') }}#how-it-works">How It Works</a>
                    <a href="{{ url_for('available_games') }}">Available Games</a>
                    <a href="{{ url_for('create_game') }}">Create Game</a>
                </nav>

                <div id="header-right">
                    <div class="btn-spacer">
                        {% if "email" in session %}
                            <a href="{{ url_for('dashboard') }}" class="btn" id="sign-up-btn">Dashboard</a>
                            <a href="{{ url_for('logout') }}" class="btn" id="join-now-btn">Logout</a>
                            <a href="{{url_for('dashboard')}}">
                                <img src="{{ picture }}" alt="Profile Picture" class="profile-pic">
                            </a>
                        {% else %}
                            <a href="{{ url_for('sign_up') }}" class="btn" id="sign-up-btn">Sign Up</a>
                            <a href="{{ url_for('login') }}" class="btn btn-green" id="join-now-btn">Login</a>
                        {% endif %}
                    </div>

                    <div class="hamburger">
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                    </div>
                </div>
            </div>

            <nav id="hamburger-header-nav">
                <a href="{{ url_for('home') }}#header">Home</a>
                <a href="{{ url_for('home') }}#how-it-works">How It Works</a>
                <a href="{{ url_for('available_games') }}">Available Games</a>
                <a href="{{ url_for('create_game') }}">Create Game</a>
            </nav>
        </header>
    </section>

    <!--MAIN-->
    <main>
        <section id="available-games">
            <h1 class="section-title">Available Games</h1>
            {% if error %}
                <div class="error-message">{{ error }}</div>
            {% endif %}

            {% if success %}
                <div class="success-message" id="available-games-success">{{ success }}</div>
            {% endif %}

            <div class="games-container">
                {% if games %}
                    {% for game in games %}
                    <div class="game-card">
                        <div class="game-card-top">
                            <div class="img-background">
                                <img src="{{ url_for('static', filename='assets/football-icon.svg') }}" alt="{{ game.sports_type }} Icon">
                            </div>
                            <div class="game-info">
                                <h2>{{ game.game_name }}</h2>
                                <p class="info">
                                    <span>{{ game.players|length }}/{{ game.player_capacity }} players</span> | Type: {{ game.sports_type }} | Age: {{ game.age }}
                                </p>
                                <p class="info">
                                    <span>{{ game.date }}</span> | Time: {{ game.time }} | Location: {{ game.location }}
                                    {% if session.get("user_id") %}
                                        {% set joined = game.players|selectattr("user_id", "equalto", session["user_id"])|list %}
                                    {% else %}
                                        {% set joined = [] %}
                                    {% endif %}

                                </p>
                            </div>
                        </div>
                        <div class="game-card-bottom">
                            <div class="buttons">
                                <form action="{{ url_for('join_game', game_id=game.id) }}" method="POST" style="display:inline;">
                                {% if joined %}
                                    <button type="submit" class="btn leave-btn" formaction="{{ url_for('leave_game', game_id=game.id) }}">
                                        Leave Game
                                    </button>
                                {% elif game.players|length >= game.player_capacity %}
                                    <button type="button" class="btn join-btn" disabled>Full</button>
                                {% else %}
                                    <button type="submit" class="btn join-btn">Join Now</button>
                                {% endif %}
                                </form>
                                <button
                                    class="btn details-btn"
                                    data-title="{{ game.game_name }}"
                                    data-info="Name: {{game.game_name}}; Date: {{game.date}}; Time: {{game.time}}; Type: {{ game.sports_type }}; Players: {{ game.players|length }}/{{ game.player_capacity }}; Price: {% if game.price == 0 %}Free{% else %}€{{ game.price }}{% endif %}; Age: {{game.age}}; Description: {{game.description}}">Details
                                </button>
                            
                            
                            
                            </div>
                        </div>
                        <span class="price-tag {% if game.price == 0 %}free{% else %}paid{% endif %}">
                            {% if game.price == 0 %}FREE{% else %}€{{ game.price }}{% endif %}
                        </span>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="no-games">No games available yet. <a href="{{ url_for('create_game') }}">Create one here</a>.</p>
                {% endif %}
            </div>

            {% if games %}
            <div class="view-more">
                <button class="btn view-more-btn">View More</button>
            </div>
            {% endif %}
        </section>
    </main>

    <!--FOOTER-->
    <footer>
        <div class="container">
            <div id="footer-content">
                <!-- Left Side -->
                <div id="footer-left">
                    <p id="footer-title">FootMatch</p>
                    <ul>
                        <li><a href="{{ url_for('home') }}#header">Home</a></li>
                        <li><a href="{{ url_for('home') }}#how-it-works">How It Works</a></li>
                        <li><a href="#header">Available Games</a></li>
                        <li><a href="{{ url_for('create_game') }}">Create Game</a></li>
                    </ul>
                </div>

                <!-- Right Side -->
                <div id="footer-right">
                    <p id="follow-us">Follow Us</p>
                    <img src="/static/assets/facebook.svg" alt="Facebook" />
                    <img src="/static/assets/twitter.svg" alt="Twitter" />
                    <img src="/static/assets/linkedin.svg" alt="LinkedIn" />
                    <img src="/static/assets/youtube.svg" alt="YouTube" />
                    <img src="/static/assets/instagram.svg" alt="Instagram" />
                </div>
            </div>

            <hr />
            <p id="rights">&copy; 2024 FootMatch. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
